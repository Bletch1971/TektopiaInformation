name: $(VersionMajor).$(VersionMinor).$(VersionRevision)

trigger:
  branches:
    include:
    - source
  paths:
    include:
    - src

pool:
#  vmImage: windows-latest
  demands: jdk_8

resources:
  repositories:
  - repository: MasterRepo
    type: GitHub
    endpoint: Bletch1971
    name: Bletch1971/TektopiaInformation
  - repository: CommonRepo
    type: GitHub
    endpoint: Bletch1971
    name: Bletch1971/TektopiaCommon
    ref: source

variables:
- name: ApplicationName
  value: 'TektopiaInformation' #$(Build.DefinitionName)
- name: CommonApplicationName
  value: 'TektopiaCommon'

stages:
- template: azure-pipelines-build.yml@self
  parameters:
    ApplicationName: $(ApplicationName)
    CommonApplicationName: $(CommonApplicationName)
    PublishFolder: $(PublishFolder)
    TektopiaVersion: '1.1.0'

- template: azure-pipelines-deploy.yml@self
  parameters:
    DeploymentType: Beta
    DependsOn: build
    ApplicationName: $(ApplicationName)
    PublishFolder: $(PublishFolder)
    RepositoryFolder: $(RepositoryFolderBeta)
    GitEmail: $(GitEmail)
    GitUsername: $(GitUsername)

- template: azure-pipelines-deploy.yml@self
  parameters:
    DeploymentType: Production
    DependsOn: Beta
    ApplicationName: $(ApplicationName)
    PublishFolder: $(PublishFolder)
    RepositoryFolder: $(RepositoryFolderProduction)
    GitEmail: $(GitEmail)
    GitUsername: $(GitUsername)
